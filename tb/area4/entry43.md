# []()【挖坑】ae脚本入门  
原作者 百度贴吧:人间之表 [原地址](https://tieba.baidu.com/p/2925807922) 首发时间:2014-03-16 23:38  
最新获取时间:2021-04-26  
  
上课无聊的时候就慢慢更新  

![](/tb/area4/entry43_pic/0.jpg)
  
需要有一定编程基础、或者基础的表达式的熟练运用能力  
  
  
  
上学期学了线代1，然后脑洞大开想写一个定位斜椭圆的脚本，根据几个参考点找出斜椭圆的圆心旋转角度离心率焦点，然后写了一两天后弃坑，原因是解方程的特征值和特征向量好麻烦，果然数学和脚本是没法相爱的。
![](/tb/area4/entry43_pic/1.jpg)
  

先分享个ae脚本一些常用东西的参考网站，是日文的，不过方便差，页面翻译一下也能看  
http://aejsx.hiroshisaito.net/layercollection-object/methods/byname  

ae脚本guide，cs6版本，英文版，官方的  
http://blogs.adobe.com/aftereffects/files/2012/06/After-Effects-CS6-Scripting-Guide.pdf?file=2012/06/After-Effects-CS6-Scripting-Guide.pdf  

此账号链接 灬丝竹青衣丨丶，可能会id发帖  
  
先讲讲脚本能做什么，和表达式有什么区别  
1、  
表达式只能改变对应属性的数值、无法改变其他图层或者其他属性的数值  
脚本是全局的，能够访问修改任意数值属性并且打关键帧设置关键帧动画  
2、  
表达式是每一帧计算一次，而且计算方式并非从前往后，而是一种更加高效而难以捉摸的计算顺序的，因此，两个表达式互相调用的话是没有效果的，只会有奇怪的现象  
脚本是全局的，能够对任意时间对图层进行操作  
3、  
脚本自由度更高  
4、  
脚本无法直接修改图层的内容，只能对图层操作，手动能做到的，脚本一般都能做到，但比如修改一个像素的内容而不适用任何特效，这是脚本做不到的，这是插件的工作了  

5、  
脚本可以对mask shape属性进行计算上的设定，而表达式做不到  

6、表达式可以对相同或者相似的人工操作进行流水线一般的优化，所谓的一键XX  

7、表达式可以一键生成青空工程![](/tb/area4/entry43_pic/2.jpg)看到这里是不是有吸引力了?  


![](/tb/area4/entry43_pic/3.jpg)
刚开始写脚本的时候，最有效率的办法就是拆别人已经写好的脚本，拆一些简单的脚本，比如说批量修改图层锚点之类的脚本，一些窗口的写法、还有对图层的调用都是很好的范例。  

很重要的一点：很多时候会有比脚本更加高效的办法，尤其是一些想起来特别简单的操作，比如修改遮罩的起点和方向，之间没找到这个，结果自己写了个比较简单但也花了小时间加工的脚本，经过团神的一下点拨让这段脚本又深深埋藏在电脑底部。  
  
旋转前↓  

![](/tb/area4/entry43_pic/4.jpg)
  
  
旋转后↓  

![](/tb/area4/entry43_pic/5.jpg)
  

![](/tb/area4/entry43_pic/6.jpg)原来已经过零点了，小的先滚床去，明天上完大英回来更新，主要从那个“对多个图层调整定位点”开始  


![](/tb/area4/entry43_pic/7.jpg)
  
首先打开脚本编辑器，左上角是软件共同的东西，help里面也有个guide，主要是界面的写法，其他没什么需要另外注意的  
左上角还有脚本的标签栏，可以像浏览器一样拖出来，但主菜单仍然只有一个  

![](/tb/area4/entry43_pic/8.jpg)
  
这里的下拉框决定了应用脚本的软件，这里我们选ae，ae和默认的那个在构造界面的时候会有少许不同，比如在StaticText还是EditText控件里面，回车\n一个显示回车一个不显示（也可能是我用的姿势不对，不过这不是重点），事实上在脚本中可以得到调用这个脚本的软件名字和版本  
  
  
右上角是调试窗口 ，可以用来查看变量的数值、额外临时执行一些语句  
右下角是所有变量的属性浏览  
  


![](/tb/area4/entry43_pic/9.jpg)
  
调试的时候主要用到的几个按钮  

Step1、在写脚本前，首先要想好这个脚本是给自己用的还是给别人用的，如果给自己用的，界面没必要写的太精致，自己能理解能调整就好，如果给别人用的，要加工一下界面，变得友好一点，还有各种功能的实现都要符合一个没用过这个脚本的人的想法。还要考虑这个脚本是给英文版ae用的还是中文版的（我只写过英文版ae的）  

Step2、脚本大体上的结构要把握好。我的习惯是这样的，变量名写一个模块的最上面、然后函数写中间、最后写一些要执行的语句，这里看不懂没关系，等会儿我会详细讲脚本语言的。还有各个模块一定要分清楚层次关系，还有最重要的，分模块，尽量不要吧所有的代码写一团在一个地方  


![](/tb/area4/entry43_pic/10.jpg)
  

![](/tb/area4/entry43_pic/11.jpg)
  
首先我们写一个亘古不变的hello world语句。在js中，每一行语句以分号结尾，并且是从上而下从外到里的过程执行的。  
注意：如果在代码里面定义了一个函数，那这仅仅只是定义声明而已，并不会执行，所以我们需要调用这个函数来执行他。一般为了保证这个结构的完整性，我习惯上会定义一个main函数（或者其他名字)，然后在调用这个main，像下面这个一样  

![](/tb/area4/entry43_pic/12.jpg)
  
这里我把代码缩起来了，按左边的加号可以展开，按减号可以对一个配对的括号内容进行收拢。  

有问题请直接回复，我可能有讲不清楚的地方  

我们现在的目的是，对选中的图层调整锚点位置，先简单一点，全部设置为图层的左上角定点，而且这个脚本是给自己用的，不需要写界面  

首先，我们需要找到我们当前正在编辑的合成位置  
var mycomp = app.project.activeItem;  
var是一个定义变量的语句，可以省略，所以在表达式中，也可以直接拿一个变量来用，但严谨一点最好还是用var来定义。这里的意思是说，把当前正在活动的项目赋值给一个新产生的mycomp变量，意思就是说，mycomp就是你当前获得焦点（正在编辑）的合成  

我们需要的是选中的图层，所以我们去翻一翻找一找，可以发现这个东西  

![](/tb/area4/entry43_pic/13.jpg)
  
大概的意思就是说，返回一个Layer对象的一个数组，是序列为index的合成（也就是我上面用到的mycomp）中所有选中的图层  
（其实我不懂日文，上面的都是我编的，我编不下去了）  

这里普及补充一下这里【.】的作用，  
这个.表示所属的意思，拿mycomp.name来说，name是mycomp的属性，是属于mycomp的东西  
而对选中的图层的用法是：[合成].selectedLayers。而合成等价于app.project.item(index)，得到的是一个图层，我们app.project.activeItem返回的同样是一个图层（是当前的图层），所以上面写着的是  
app.project.item(index).selectedLayers  

如何知道一个数组里面有多少个元素呢？  
比如数组arr，arr.length就是它的长度，所以我们如何知道我们选中了多少个图层呢？  
  
答案就是mycomp.selectedLayers.length
![](/tb/area4/entry43_pic/14.jpg)
  

快要上课去了，晚上还要填坑，明天继续更新，布置个作业  
作业1：输出当前合成的工作区的终点。  

普及基础知识：在js中括号的作用  
如果我们需要再一个for循环中同时干两件事，比如同时输出名字和序号，那么正确的写法应该是这样的  
for(var i = 0; i < length; i++){    alert(mylayers[i].name);    alert(mylayers[i].index);}  
括号写的位置是个人的习惯，比如  
for(var i = 0; i < length; i++)  
{  
alert(mylayers[i].name);  
alert(mylayers[i].index);  
}  
一对括号就相当于是把内容打包  
如果像  
for(var i = 0; i < length; i++)  
alert(mylayers[i].name);  
alert(mylayers[i].index);  
那么实际上每次循环只执行了  
alert(mylayers[i].name);  
，而下面那一句是在循环结束后才执行的  

